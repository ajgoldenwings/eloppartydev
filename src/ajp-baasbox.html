<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="ajp-baasbox-user-data.html">

<dom-module id="ajp-baasbox">

	<script src="../scripts/jquery.min.js"></script>
	<script src="../baasbox/baasbox-0.8.4.min.js"></script>

	<template>
		<app-location route="{{route}}"></app-location>
		<app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>

		<iron-localstorage
				name="ajp-baasbox"
				value="[[baasbox]]"
				on-iron-localstorage-load-empty="_initializeBaasbox"></iron-localstorage>

    <ajp-baasbox-user-data id="user" cart="{{user}}"></ajp-baasbox-user-data>
	</template>

	<script>

		Polymer({

			is: 'ajp-baasbox',

			properties: {

			},

      ready: function() {
				this._setEndPoint("https://baasbox.elopparty.com");
				this._setAppCode("1234567890");
      },

			myAction: function(event) {
				console.log(event.detail);
				return false;
			},

      signUp: function(name,password) {
				var signUpThis = this;
				BaasBox.fetchUserProfile(name)
				.done(function(res) {
					signUpThis.fire('fireShowSnack', {action: 'showSnack', message: 'User Exists.'});
				})
				.fail(function(error) {
					BaasBox.signup(name, password)
					.done(function (res) {
						signUpThis.set('route.path', '/user-info');
					})
					.fail(function (error) {
						signUpThis.fire('fireShowSnack', {action: 'showSnack', message: 'Network error. User failed to signup.'});
					});
				});
      },

			_setAppCode(appCode) {
				BaasBox.appcode = appCode;
			},

			_setEndPoint(endPoint) {
				BaasBox.setEndPoint(endPoint);
			},

      _initializeBaasbox: function() {

      }

		});

	</script>

</dom-module>
